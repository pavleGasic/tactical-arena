{"version":3,"sources":["app/frontend/ui/battlefield/overlay.cljs"],"mappings":"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","names":["app.frontend.ui.battlefield.overlay/on-placeholder-click","dx","dy","cljs.core.swap_BANG_","app.frontend.ui.battlefield.state/characters","cs","cljs.core.mapv","c","sprite","app.frontend.ui.battlefield.characters/animate-move!","cljs.core.assoc","app.frontend.ui.battlefield.overlay/clear-overlay!","map-container","seq__37042","cljs.core/seq","cljs.core/deref","chunk__37043","count__37044","i__37045","temp__5823__auto__","cljs.core/chunked-seq?","c__5525__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","s","app.frontend.ui.battlefield.state/overlay-placeholders","cljs.core/reset!","app.frontend.ui.battlefield.overlay/display-move-overlay","character","texture","map__37049","cljs.core/--destructure-map","cljs.core.get","radius","app.frontend.ui.battlefield.config/move-overlay-radius","x","y","seq__37050","chunk__37057","count__37058","i__37059","seq__37060","chunk__37062","count__37063","i__37064","seq__37051","chunk__37053","count__37054","i__37055","cljs.core.range","and__5000__auto__","cljs.core.not_EQ_","app.frontend.ui.battlefield.sprites/walkable-tile?","app.frontend.ui.battlefield.state/map-data","app.frontend.ui.battlefield.sprites/create-map-tile-sprite","_","cljs.core/conj"],"sourcesContent":["(ns app.frontend.ui.battlefield.overlay\n  (:require [app.frontend.ui.battlefield.state :as state]\n            [app.frontend.ui.battlefield.config :as config]\n            [app.frontend.ui.battlefield.sprites :as sprites]\n            [app.frontend.ui.battlefield.characters :as characters]))\n\n\n(defn on-placeholder-click [dx dy]\n  (swap! state/characters\n         (fn [cs]\n           (mapv (fn [c]\n                   (if (:selected? c)\n                     (do\n                       (let [sprite (:sprite c)]\n                         (characters/animate-move! sprite\n                                                   (:x c) (:y c)\n                                                   dx dy))\n                       (assoc c :x dx :y dy :selected? false))\n                     c))\n                 cs))))\n\n(defn clear-overlay! [map-container]\n  (doseq [s @state/overlay-placeholders]\n    (.removeChild ^js map-container s))\n  (reset! state/overlay-placeholders []))\n\n(defn display-move-overlay [map-container character texture]\n  (let [radius config/move-overlay-radius\n        {:keys [x y]} character]\n    (doseq [dx (range (- x radius) (+ x radius 1))\n            dy (range (- y radius) (+ y radius 1))\n            :when (and (not= [dx dy] [x y])\n                       (sprites/walkable-tile? dx dy @state/map-data))]\n      (let [sprite (sprites/create-map-tile-sprite texture 0 dx dy)]\n        (set! (.-alpha sprite) 0.6)\n        (set! (.-eventMode sprite) \"dynamic\")\n        (set! (.-buttonMode sprite) true)\n        (.on sprite \"pointerdown\"\n             (fn [_]\n               (on-placeholder-click dx dy)\n               (clear-overlay! map-container)))\n        (.addChild ^js map-container sprite)\n        (swap! state/overlay-placeholders conj sprite)))))\n\n\n"]}