{"version":3,"sources":["app/frontend/ui/battlefield/overlay.cljs"],"mappings":"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","names":["app.frontend.ui.battlefield.overlay/on-placeholder-click","dx","dy","cljs.core.swap_BANG_","app.frontend.ui.battlefield.state/characters","cs","cljs.core.mapv","c","js/console.log","cljs.core/clj->js","sprite","app.frontend.ui.battlefield.characters/animate-move!","cljs.core.assoc","app.frontend.ui.battlefield.overlay/clear-overlay!","map-container","seq__40485","cljs.core/seq","cljs.core/deref","chunk__40486","count__40487","i__40488","temp__5823__auto__","cljs.core/chunked-seq?","c__5525__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","s","app.frontend.ui.battlefield.state/overlay-placeholders","cljs.core/reset!","app.frontend.ui.battlefield.overlay/display-move-overlay","character","texture","map__40491","cljs.core/--destructure-map","cljs.core.get","radius","app.frontend.ui.battlefield.config/move-overlay-radius","x","y","seq__40492","chunk__40499","count__40500","i__40501","seq__40502","chunk__40504","count__40505","i__40506","seq__40493","chunk__40495","count__40496","i__40497","cljs.core.range","cljs.core.not_EQ_","app.frontend.ui.battlefield.sprites/create-map-tile-sprite","_","cljs.core/conj"],"sourcesContent":["(ns app.frontend.ui.battlefield.overlay\n  (:require [app.frontend.ui.battlefield.state :as state]\n            [app.frontend.ui.battlefield.config :as config]\n            [app.frontend.ui.battlefield.sprites :as sprites]\n            [app.frontend.ui.battlefield.characters :as characters]))\n\n\n(defn on-placeholder-click [dx dy]\n  (swap! state/characters\n         (fn [cs]\n           (mapv (fn [c]\n                   (js/console.log (clj->js (:selected? c)))\n                   (if (:selected? c)\n                     (do\n                       (js/console.log (clj->js (:sprite c)))\n                       (let [sprite (:sprite c)]\n                         (characters/animate-move! sprite\n                                                   (:x c) (:y c)\n                                                   dx dy))\n                       (assoc c :x dx :y dy :selected? false))\n                     c))\n                 cs))))\n\n(defn clear-overlay! [map-container]\n  (doseq [s @state/overlay-placeholders]\n    (.removeChild ^js map-container s))\n  (reset! state/overlay-placeholders []))\n\n(defn display-move-overlay [map-container character texture]\n  (let [radius config/move-overlay-radius\n        {:keys [x y]} character]\n    (doseq [dx (range (- x radius) (+ x radius 1))\n            dy (range (- y radius) (+ y radius 1))\n            :when (not= [dx dy] [x y])]\n      (let [sprite (sprites/create-map-tile-sprite texture 0 dx dy)]\n        (set! (.-alpha sprite) 0.6)\n        (set! (.-eventMode sprite) \"dynamic\")\n        (set! (.-buttonMode sprite) true)\n        (.on sprite \"pointerdown\"\n             (fn [_]\n               (on-placeholder-click dx dy)\n               (clear-overlay! map-container)))\n        (.addChild ^js map-container sprite)\n        (swap! state/overlay-placeholders conj sprite)))))\n\n\n"]}