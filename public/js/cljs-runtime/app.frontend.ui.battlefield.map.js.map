{"version":3,"sources":["app/frontend/ui/battlefield/map.cljs"],"mappings":"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","names":["app.frontend.ui.battlefield.map/load-map!","js/fetch","p1__40435#","p1__40436#","cljs.core/reset!","app.frontend.ui.battlefield.state/map-data","cljs.core.js__GT_clj","p1__40437#","js/console.error","p__40438","map__40439","cljs.core/--destructure-map","cljs.core.get","app.frontend.ui.battlefield.map/calc-map-dimensions","tileSize","layers","height-in-tiles","cljs.core.apply","cljs.core/max","cljs.core.mapcat","layer","cljs.core.map","width-in-tiles","map-height","app.frontend.ui.battlefield.config/tile-scale","map-width","app.frontend.ui.battlefield.map/populate-map-container!","map-container","texture","seq__40441","cljs.core/seq","chunk__40446","count__40447","i__40448","map__40481","seq__40449","chunk__40450","count__40451","i__40452","map__40484","temp__5823__auto__","cljs.core/chunked-seq?","c__5525__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","map__40489","cljs.core/first","cljs.core/next","map__40490","seq__40442","chunk__40443","count__40444","i__40445","map__40510","map__40511","tiles","id","x","y","sprite","app.frontend.ui.battlefield.sprites/create-map-tile-sprite","js/console.log","cljs.core/clj->js","app.frontend.ui.battlefield.map/setup-drag-handlers!","container","screen-width","screen-height","dragging","reagent.core.atom","offset","event","pos","cljs.core/deref","new-x","Math/floor","new-y","clamped-x","x__5087__auto__","y__5088__auto__","x__5090__auto__","y__5091__auto__","clamped-y"],"sourcesContent":["(ns app.frontend.ui.battlefield.map\n  (:require [app.frontend.ui.battlefield.state :as state]\n            [app.frontend.ui.battlefield.config :as config]\n            [app.frontend.ui.battlefield.sprites :as sprites]\n            [reagent.core :as r]))\n\n(defn load-map! []\n  (-> (js/fetch \"/assets/map.json\")\n      (.then #(.json %))\n      (.then #(reset! state/map-data (js->clj % :keywordize-keys true)))\n      (.catch #(js/console.error \"Failed to load map:\" %))))\n\n(defn calc-map-dimensions [{:keys [tileSize layers]}]\n  (let [height-in-tiles (apply max (mapcat (fn [layer] (map :y (:tiles layer))) layers))\n        width-in-tiles (apply max (mapcat (fn [layer] (map :x (:tiles layer))) layers))\n        map-height (* (inc height-in-tiles) tileSize config/tile-scale)\n        map-width (* (inc width-in-tiles) tileSize config/tile-scale)]\n    {:map-height map-height :map-width map-width}))\n\n(defn populate-map-container! [map-container layers texture]\n  (doseq [{:keys [tiles]} layers\n          {:keys [id x y]} tiles]\n    (let [sprite (sprites/create-map-tile-sprite texture id x y)]\n      (js/console.log (clj->js sprite))\n      (.addChild ^js map-container sprite))))\n\n(defn setup-drag-handlers! [container screen-width screen-height map-width map-height]\n  (let [dragging (r/atom false)\n        offset (r/atom {:x 0 :y 0})]\n    (.on container \"pointerdown\"\n         (fn [event]\n           (reset! dragging true)\n           (let [pos (.-global (.-data event))]\n             (reset! offset {:x (- (.-x pos) (.-x container))\n                             :y (- (.-y pos) (.-y container))}))))\n    (.on container \"pointerup\" #(reset! dragging false))\n    (.on container \"pointerupoutside\" #(reset! dragging false))\n    (.on container \"pointermove\"\n         (fn [event]\n           (when @dragging\n             (let [pos (.-global (.-data event))\n                   new-x (Math/floor (- (.-x pos) (:x @offset)))\n                   new-y (Math/floor (- (.-y pos) (:y @offset)))\n                   clamped-x (max (min 0 new-x) (- screen-width map-width))\n                   clamped-y (max (min 0 new-y) (- screen-height map-height))]\n               (set! (.-x container) clamped-x)\n               (set! (.-y container) clamped-y)))))\n    (set! (.-eventMode container) \"dynamic\")))"]}