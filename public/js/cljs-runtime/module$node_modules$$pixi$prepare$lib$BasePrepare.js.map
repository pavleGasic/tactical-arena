{
"version":3,
"file":"module$node_modules$$pixi$prepare$lib$BasePrepare.js",
"lineCount":115,
"mappings":"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",
"sources":["node_modules/@pixi/prepare/lib/BasePrepare.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$pixi$prepare$lib$BasePrepare\"] = function(global,require,module,exports) {\n\"use strict\";\nvar core = require(\"@pixi/core\"), display = require(\"@pixi/display\"), text = require(\"@pixi/text\"), CountLimiter = require(\"./CountLimiter.js\");\nfunction findMultipleBaseTextures(item, queue) {\n  let result = !1;\n  if (item?._textures?.length) {\n    for (let i = 0; i < item._textures.length; i++)\n      if (item._textures[i] instanceof core.Texture) {\n        const baseTexture = item._textures[i].baseTexture;\n        queue.includes(baseTexture) || (queue.push(baseTexture), result = !0);\n      }\n  }\n  return result;\n}\nfunction findBaseTexture(item, queue) {\n  if (item.baseTexture instanceof core.BaseTexture) {\n    const texture = item.baseTexture;\n    return queue.includes(texture) || queue.push(texture), !0;\n  }\n  return !1;\n}\nfunction findTexture(item, queue) {\n  if (item._texture && item._texture instanceof core.Texture) {\n    const texture = item._texture.baseTexture;\n    return queue.includes(texture) || queue.push(texture), !0;\n  }\n  return !1;\n}\nfunction drawText(_helper, item) {\n  return item instanceof text.Text ? (item.updateText(!0), !0) : !1;\n}\nfunction calculateTextStyle(_helper, item) {\n  if (item instanceof text.TextStyle) {\n    const font = item.toFontString();\n    return text.TextMetrics.measureFont(font), !0;\n  }\n  return !1;\n}\nfunction findText(item, queue) {\n  if (item instanceof text.Text) {\n    queue.includes(item.style) || queue.push(item.style), queue.includes(item) || queue.push(item);\n    const texture = item._texture.baseTexture;\n    return queue.includes(texture) || queue.push(texture), !0;\n  }\n  return !1;\n}\nfunction findTextStyle(item, queue) {\n  return item instanceof text.TextStyle ? (queue.includes(item) || queue.push(item), !0) : !1;\n}\nconst _BasePrepare = class _BasePrepare2 {\n  /**\n   * @param {PIXI.IRenderer} renderer - A reference to the current renderer\n   */\n  constructor(renderer) {\n    this.limiter = new CountLimiter.CountLimiter(_BasePrepare2.uploadsPerFrame), this.renderer = renderer, this.uploadHookHelper = null, this.queue = [], this.addHooks = [], this.uploadHooks = [], this.completes = [], this.ticking = !1, this.delayedTick = () => {\n      this.queue && this.prepareItems();\n    }, this.registerFindHook(findText), this.registerFindHook(findTextStyle), this.registerFindHook(findMultipleBaseTextures), this.registerFindHook(findBaseTexture), this.registerFindHook(findTexture), this.registerUploadHook(drawText), this.registerUploadHook(calculateTextStyle);\n  }\n  /**\n   * Upload all the textures and graphics to the GPU.\n   * @method PIXI.BasePrepare#upload\n   * @param {PIXI.DisplayObject|PIXI.Container|PIXI.BaseTexture|PIXI.Texture|PIXI.Graphics|PIXI.Text} [item] -\n   *        Container or display object to search for items to upload or the items to upload themselves,\n   *        or optionally ommitted, if items have been added using {@link PIXI.BasePrepare#add `prepare.add`}.\n   */\n  upload(item) {\n    return new Promise((resolve) => {\n      item && this.add(item), this.queue.length ? (this.completes.push(resolve), this.ticking || (this.ticking = !0, core.Ticker.system.addOnce(this.tick, this, core.UPDATE_PRIORITY.UTILITY))) : resolve();\n    });\n  }\n  /**\n   * Handle tick update\n   * @private\n   */\n  tick() {\n    setTimeout(this.delayedTick, 0);\n  }\n  /**\n   * Actually prepare items. This is handled outside of the tick because it will take a while\n   * and we do NOT want to block the current animation frame from rendering.\n   * @private\n   */\n  prepareItems() {\n    for (this.limiter.beginFrame(); this.queue.length && this.limiter.allowedToUpload(); ) {\n      const item = this.queue[0];\n      let uploaded = !1;\n      if (item && !item._destroyed) {\n        for (let i = 0, len = this.uploadHooks.length; i < len; i++)\n          if (this.uploadHooks[i](this.uploadHookHelper, item)) {\n            this.queue.shift(), uploaded = !0;\n            break;\n          }\n      }\n      uploaded || this.queue.shift();\n    }\n    if (this.queue.length)\n      core.Ticker.system.addOnce(this.tick, this, core.UPDATE_PRIORITY.UTILITY);\n    else {\n      this.ticking = !1;\n      const completes = this.completes.slice(0);\n      this.completes.length = 0;\n      for (let i = 0, len = completes.length; i < len; i++)\n        completes[i]();\n    }\n  }\n  /**\n   * Adds hooks for finding items.\n   * @param {Function} addHook - Function call that takes two parameters: `item:*, queue:Array`\n   *          function must return `true` if it was able to add item to the queue.\n   * @returns Instance of plugin for chaining.\n   */\n  registerFindHook(addHook) {\n    return addHook && this.addHooks.push(addHook), this;\n  }\n  /**\n   * Adds hooks for uploading items.\n   * @param {Function} uploadHook - Function call that takes two parameters: `prepare:CanvasPrepare, item:*` and\n   *          function must return `true` if it was able to handle upload of item.\n   * @returns Instance of plugin for chaining.\n   */\n  registerUploadHook(uploadHook) {\n    return uploadHook && this.uploadHooks.push(uploadHook), this;\n  }\n  /**\n   * Manually add an item to the uploading queue.\n   * @param {PIXI.DisplayObject|PIXI.Container|PIXI.BaseTexture|PIXI.Texture|PIXI.Graphics|PIXI.Text|*} item - Object to\n   *        add to the queue\n   * @returns Instance of plugin for chaining.\n   */\n  add(item) {\n    for (let i = 0, len = this.addHooks.length; i < len && !this.addHooks[i](item, this.queue); i++)\n      ;\n    if (item instanceof display.Container)\n      for (let i = item.children.length - 1; i >= 0; i--)\n        this.add(item.children[i]);\n    return this;\n  }\n  /** Destroys the plugin, don't use after this. */\n  destroy() {\n    this.ticking && core.Ticker.system.remove(this.tick, this), this.ticking = !1, this.addHooks = null, this.uploadHooks = null, this.renderer = null, this.completes = null, this.queue = null, this.limiter = null, this.uploadHookHelper = null;\n  }\n};\n_BasePrepare.uploadsPerFrame = 4;\nlet BasePrepare = _BasePrepare;\nexports.BasePrepare = BasePrepare;\n//# sourceMappingURL=BasePrepare.js.map\n\n};"],
"names":["shadow$provide","global","require","module","exports","findMultipleBaseTextures","item","queue","result","_textures","length","i","core","Texture","baseTexture","includes","push","findBaseTexture","BaseTexture","texture","findTexture","_texture","drawText","_helper","text","Text","updateText","calculateTextStyle","TextStyle","font","toFontString","TextMetrics","measureFont","findText","style","findTextStyle","display","CountLimiter","constructor","renderer","limiter","_BasePrepare2","uploadsPerFrame","uploadHookHelper","addHooks","uploadHooks","completes","ticking","delayedTick","this.delayedTick","prepareItems","registerFindHook","registerUploadHook","upload","Promise","resolve","add","Ticker","system","addOnce","tick","UPDATE_PRIORITY","UTILITY","setTimeout","beginFrame","allowedToUpload","uploaded","_destroyed","len","shift","slice","addHook","uploadHook","Container","children","destroy","remove","_BasePrepare","BasePrepare"]
}
